{"ast":null,"code":"import _toConsumableArray from\"/Users/boris/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/boris/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useEffect,useState}from'react';import{Route,Switch,BrowserRouter,useHistory,Redirect}from'react-router-dom';import Header from'./Header';import Register from'./Register';import Login from'./Login';import Main from'./Main';import ImagePopup from'./ImagePopup';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import DeleteCardPopup from'./DeleteCardPopup';import InfoToolTip from'./InfoTooltip';import Footer from'./Footer';import api from'../utils/api';import ProtectedRoute from'./ProtectedRoute';import{CurrentUserContext}from'../contexts/CurrentUserContext';import{setToken,getToken,removeToken}from'../utils/token';import*as auth from'./Auth';function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditAvatarPopupOpen=_useState2[0],setEditAvatarPopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isEditProfilePopupOpen=_useState4[0],setEditProfilePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isAddPlacePopupOpen=_useState6[0],setAddPlacePopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isInfoToolTipOpen=_useState8[0],setInfoToolTipOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),selectedCard=_useState10[0],setSelectedCard=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isDeleteCardPopupOpen=_useState12[0],setDeleteCardPopupOpen=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),cardDelete=_useState14[0],setCardDelete=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),currentUser=_useState16[0],setCurrentUser=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),cards=_useState18[0],setCards=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),isLoading=_useState20[0],setLoading=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isSuccess=_useState22[0],setSuccess=_useState22[1];var _useState23=useState(''),_useState24=_slicedToArray(_useState23,2),userEmail=_useState24[0],setUserEmail=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),loggedIn=_useState26[0],setLoggedIn=_useState26[1];var history=useHistory();useEffect(function(){Promise.all([api.getUserInfo(),api.getInitialCards()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),user=_ref2[0],cards=_ref2[1];setCurrentUser(user);setCards(cards);}).catch(function(err){console.log(err);});},[]);var tokenCheck=function tokenCheck(){var jwt=getToken('jwt');if(!jwt){return;}auth.checkToken(jwt).then(function(res){if(res){setLoggedIn(true);history.push('/');setUserEmail(res.data.email);}}).catch(function(err){console.log(err);setLoggedIn(false);});};useEffect(function(){tokenCheck();},[]);var handleLogin=function handleLogin(userEmail,userPassword){auth.authorize(userEmail,userPassword).then(function(data){if(!data){console.log('Что-то пошло не так!');}else{setToken(data.token);setLoggedIn(true);setUserEmail(userEmail);history.push('/');}}).catch(function(err){return console.log(err);});};var handleLogOut=function handleLogOut(){setLoggedIn(false);removeToken('jwt');};var handleRegister=function handleRegister(userEmail,userPassword){auth.register(userEmail,userPassword).then(function(res){if(res===undefined){setSuccess(false);setInfoToolTipOpen(true);}else if(res.status!==400){history.push('/signin');setSuccess(true);setInfoToolTipOpen(true);}}).catch(function(error){return console.log(error);});};var handleEditAvatarClick=function handleEditAvatarClick(){setEditAvatarPopupOpen(true);};var handleEditProfileClick=function handleEditProfileClick(){setEditProfilePopupOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setAddPlacePopupOpen(true);};var handleDeleteCardClick=function handleDeleteCardClick(card){setDeleteCardPopupOpen(true);setCardDelete(card);};var closeAllPopups=function closeAllPopups(){setEditAvatarPopupOpen(false);setEditProfilePopupOpen(false);setAddPlacePopupOpen(false);setSelectedCard(false);setDeleteCardPopupOpen(false);setInfoToolTipOpen(false);setLoading(false);};var handleUpdateUser=function handleUpdateUser(newUserInfo){setLoading(true);api.sendUserInfo(newUserInfo).then(function(user){setCurrentUser(user);closeAllPopups();}).catch(function(err){console.log(err);});};var handleUpdateAvatar=function handleUpdateAvatar(newAvatarLink){setLoading(true);api.sendUserAvatar(newAvatarLink).then(function(user){setCurrentUser(user);closeAllPopups();}).catch(function(err){console.log(err);});};var handleCardLike=function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});var handleLikeCards=function handleLikeCards(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard:c;});setCards(newCards);};var changeLike=function changeLike(){if(!isLiked){api.likeCard(card._id).then(function(newCard){handleLikeCards(newCard);}).catch(function(err){console.log(err);});}else{api.deleteLikeCard(card._id).then(function(newCard){handleLikeCards(newCard);}).catch(function(err){console.log(err);});}};changeLike();};var handleCardDelete=function handleCardDelete(card){setLoading(true);api.deleteCard(card._id).then(function(){var newCards=cards.filter(function(c){return c._id!==card._id;});setCards(newCards);closeAllPopups();}).catch(function(err){console.log(err);});};var handleAddPlaceSubmit=function handleAddPlaceSubmit(newCard){setLoading(true);api.sendCard(newCard).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);});};return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(BrowserRouter,{children:[/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,children:[/*#__PURE__*/_jsx(Header,{userEmail:userEmail,loggedIn:loggedIn,onSignOut:handleLogOut,linkTo:\"/signin\",linkName:\"\\u0412\\u044B\\u0439\\u0442\\u0438\"}),/*#__PURE__*/_jsx(Main,{onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:setSelectedCard,onCardLike:handleCardLike,onDeleteCardClick:handleDeleteCardClick,cards:cards}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,isLoading:isLoading}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,isLoading:isLoading}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,isLoading:isLoading}),/*#__PURE__*/_jsx(DeleteCardPopup,{card:cardDelete,isOpen:isDeleteCardPopupOpen,onClose:closeAllPopups,onCardDelete:handleCardDelete,isLoading:isLoading}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(Footer,{})]}),/*#__PURE__*/_jsxs(Route,{path:\"/signup\",children:[/*#__PURE__*/_jsx(Header,{userEmail:\"\",loggedIn:loggedIn,onSignOut:handleLogOut,linkTo:\"/signin\",linkName:\"\\u0412\\u043E\\u0439\\u0442\\u0438\"}),/*#__PURE__*/_jsx(Register,{onRegister:handleRegister}),/*#__PURE__*/_jsx(InfoToolTip,{isOpen:isInfoToolTipOpen,onClose:closeAllPopups,isSuccess:isSuccess})]}),/*#__PURE__*/_jsxs(Route,{path:\"/signin\",children:[/*#__PURE__*/_jsx(Header,{userEmail:\"\",loggedIn:loggedIn,onSignOut:handleLogOut,linkTo:\"/signup\",linkName:\"\\u0420\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u044F\"}),/*#__PURE__*/_jsx(Login,{onLogin:handleLogin})]})]})]})})})});}export default App;","map":{"version":3,"sources":["/Users/boris/dev/react-mesto-auth/src/components/App.js"],"names":["React","useEffect","useState","Route","Switch","BrowserRouter","useHistory","Redirect","Header","Register","Login","Main","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","DeleteCardPopup","InfoToolTip","Footer","api","ProtectedRoute","CurrentUserContext","setToken","getToken","removeToken","auth","App","isEditAvatarPopupOpen","setEditAvatarPopupOpen","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","isInfoToolTipOpen","setInfoToolTipOpen","selectedCard","setSelectedCard","isDeleteCardPopupOpen","setDeleteCardPopupOpen","cardDelete","setCardDelete","currentUser","setCurrentUser","cards","setCards","isLoading","setLoading","isSuccess","setSuccess","userEmail","setUserEmail","loggedIn","setLoggedIn","history","Promise","all","getUserInfo","getInitialCards","then","user","catch","err","console","log","tokenCheck","jwt","checkToken","res","push","data","email","handleLogin","userPassword","authorize","token","handleLogOut","handleRegister","register","undefined","status","error","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleDeleteCardClick","card","closeAllPopups","handleUpdateUser","newUserInfo","sendUserInfo","handleUpdateAvatar","newAvatarLink","sendUserAvatar","handleCardLike","isLiked","likes","some","i","_id","handleLikeCards","newCard","newCards","map","c","changeLike","likeCard","deleteLikeCard","handleCardDelete","deleteCard","filter","handleAddPlaceSubmit","sendCard"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Route, Switch, BrowserRouter, useHistory, Redirect} from 'react-router-dom';\nimport Header from './Header';\nimport Register from './Register';\nimport Login from './Login';\nimport Main from './Main';\nimport ImagePopup from './ImagePopup';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport DeleteCardPopup from './DeleteCardPopup';\nimport InfoToolTip from './InfoTooltip';\nimport Footer from './Footer';\nimport api from '../utils/api';\nimport ProtectedRoute from './ProtectedRoute';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport { setToken, getToken, removeToken } from '../utils/token';\nimport * as auth from './Auth';\n\nfunction App() {\n  const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = useState(false);\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false);\n  const [isInfoToolTipOpen, setInfoToolTipOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(false);\n  const [isDeleteCardPopupOpen, setDeleteCardPopupOpen] = useState(false);\n  const [cardDelete, setCardDelete] = useState('')\n  const [currentUser, setCurrentUser] = useState('');\n  const [cards, setCards] = useState([]);\n  const [isLoading, setLoading] = useState(false);\n  const [isSuccess, setSuccess] = useState(false);\n\n  const [userEmail, setUserEmail] = useState('');\n  const [loggedIn, setLoggedIn] = useState(false);\n\n  const history = useHistory();\n\n  useEffect(() => {\n    Promise.all([api.getUserInfo(), api.getInitialCards()])\n      .then(([user, cards]) => {\n        setCurrentUser(user);\n        setCards(cards);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }, []);\n\n  const tokenCheck = () => {\n    const jwt = getToken('jwt');\n\n    if(!jwt) {\n      return;\n    }\n\n    auth.checkToken(jwt)\n    .then((res) => {\n      if(res) {\n        setLoggedIn(true);\n        history.push('/');\n        setUserEmail(res.data.email)\n      }\n    })\n    .catch((err) => {\n      console.log(err);\n      setLoggedIn(false);\n    })\n  }\n\n  useEffect(() => {\n    tokenCheck();\n  }, []);\n\n  const handleLogin = (userEmail, userPassword) => {\n    auth.authorize(userEmail, userPassword)\n    .then((data) => {\n      if (!data){\n        console.log('Что-то пошло не так!');\n      } else {\n        setToken(data.token)\n        setLoggedIn(true);\n        setUserEmail(userEmail);\n        history.push('/');\n      }\n    })\n    .catch(err => console.log(err));\n  };\n\n  const handleLogOut = () => {\n    setLoggedIn(false);\n    removeToken('jwt');\n  };\n\n  const handleRegister = (userEmail, userPassword) => {\n    auth.register(userEmail, userPassword)\n    .then((res) => {\n      if(res === undefined) {\n        setSuccess(false);\n        setInfoToolTipOpen(true);\n      } else if(res.status !== 400) {\n        history.push('/signin');\n        setSuccess(true);\n        setInfoToolTipOpen(true);\n      }\n    })\n    .catch((error) => console.log(error));\n  };\n\n  const handleEditAvatarClick = () => {\n    setEditAvatarPopupOpen(true);\n  };\n\n  const handleEditProfileClick = () => {\n    setEditProfilePopupOpen(true);\n  };\n\n  const handleAddPlaceClick = () => {\n    setAddPlacePopupOpen(true);\n  };\n\n  const handleDeleteCardClick = (card) => {\n    setDeleteCardPopupOpen(true);\n    setCardDelete(card)\n  };\n\n  const closeAllPopups = () => {\n    setEditAvatarPopupOpen(false);\n    setEditProfilePopupOpen(false);\n    setAddPlacePopupOpen(false);\n    setSelectedCard(false);\n    setDeleteCardPopupOpen(false);\n    setInfoToolTipOpen(false);\n    setLoading(false);\n  };\n\n  const handleUpdateUser = (newUserInfo) => {\n    setLoading(true);\n    api.sendUserInfo(newUserInfo)\n      .then((user) => {\n          setCurrentUser(user);\n          closeAllPopups();\n      })\n      .catch((err) => {\n          console.log(err);\n      });\n  };\n\n  const handleUpdateAvatar = (newAvatarLink) => {\n    setLoading(true);\n    api.sendUserAvatar(newAvatarLink)\n      .then((user) => {\n        setCurrentUser(user);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  const handleCardLike = (card) => {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n    const handleLikeCards = (newCard) => {\n      const newCards = cards.map((c) => c._id === card._id ? newCard : c);\n      setCards(newCards);\n    }\n\n    const changeLike = () => {\n      if(!isLiked) {\n        api.likeCard(card._id)\n          .then((newCard) => {\n            handleLikeCards(newCard);\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n      } else {\n        api.deleteLikeCard(card._id)\n          .then((newCard) => {\n            handleLikeCards(newCard);\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n      }\n    }\n\n    changeLike();\n  };\n\n  const handleCardDelete = (card) => {\n    setLoading(true);\n    api.deleteCard(card._id)\n      .then(() => {\n        const newCards = cards.filter((c) => c._id !== card._id);\n        setCards(newCards);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  const handleAddPlaceSubmit = (newCard) => {\n    setLoading(true);\n    api.sendCard(newCard)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  return(\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page\">\n        <>\n          <BrowserRouter>\n\n            <Route>\n              {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/signin\" />}\n            </Route>\n\n            <Switch>\n\n              <ProtectedRoute exact path=\"/\" loggedIn={loggedIn}>\n\n                <Header\n                  userEmail={userEmail}\n                  loggedIn={loggedIn}\n                  onSignOut={handleLogOut}\n                  linkTo=\"/signin\"\n                  linkName=\"Выйти\"\n                />\n\n                <Main\n                  onEditAvatar={handleEditAvatarClick}\n                  onEditProfile={handleEditProfileClick}\n                  onAddPlace={handleAddPlaceClick}\n                  onCardClick={setSelectedCard}\n                  onCardLike={handleCardLike}\n                  onDeleteCardClick={handleDeleteCardClick}\n                  cards={cards}\n                />\n\n                <EditAvatarPopup\n                  isOpen={isEditAvatarPopupOpen}\n                  onClose={closeAllPopups}\n                  onUpdateAvatar={handleUpdateAvatar}\n                  isLoading={isLoading}\n                />\n\n                <EditProfilePopup\n                  isOpen={isEditProfilePopupOpen}\n                  onClose={closeAllPopups}\n                  onUpdateUser={handleUpdateUser}\n                  isLoading={isLoading}\n                />\n\n                <AddPlacePopup\n                  isOpen={isAddPlacePopupOpen}\n                  onClose={closeAllPopups}\n                  onAddPlace={handleAddPlaceSubmit}\n                  isLoading={isLoading}\n                />\n\n                <DeleteCardPopup\n                  card={cardDelete}\n                  isOpen={isDeleteCardPopupOpen}\n                  onClose={closeAllPopups}\n                  onCardDelete={handleCardDelete}\n                  isLoading={isLoading}\n                />\n\n                <ImagePopup\n                  card={selectedCard}\n                  onClose={closeAllPopups}\n                />\n\n                <Footer />\n\n              </ProtectedRoute>\n\n              <Route path=\"/signup\">\n\n              < Header\n                  userEmail=''\n                  loggedIn={loggedIn}\n                  onSignOut={handleLogOut}\n                  linkTo=\"/signin\"\n                  linkName=\"Войти\"\n                />\n\n                <Register\n                  onRegister={handleRegister}\n                />\n\n                <InfoToolTip\n                  isOpen={isInfoToolTipOpen}\n                  onClose={closeAllPopups}\n                  isSuccess={isSuccess}\n                />\n\n              </Route>\n\n              <Route path=\"/signin\">\n\n                <Header\n                  userEmail=''\n                  loggedIn={loggedIn}\n                  onSignOut={handleLogOut}\n                  linkTo=\"/signup\"\n                  linkName=\"Регистрация\"\n                />\n\n                <Login\n                  onLogin={handleLogin}\n                />\n\n              </Route>\n\n            </Switch>\n\n          </BrowserRouter>\n\n        </>\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}