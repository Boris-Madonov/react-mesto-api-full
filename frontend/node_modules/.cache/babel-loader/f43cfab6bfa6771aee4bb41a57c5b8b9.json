{"ast":null,"code":"import _toConsumableArray from\"/Users/boris/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/boris/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useEffect,useState}from'react';import{Route,Switch,BrowserRouter,useHistory,Redirect}from'react-router-dom';import Header from'./Header';import Register from'./Register';import Login from'./Login';import Main from'./Main';import ImagePopup from'./ImagePopup';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import DeleteCardPopup from'./DeleteCardPopup';import InfoToolTip from'./InfoTooltip';import Footer from'./Footer';import api from'../utils/api';import ProtectedRoute from'./ProtectedRoute';import{CurrentUserContext}from'../contexts/CurrentUserContext';import{setToken,getToken,removeToken}from'../utils/token';import*as auth from'../utils/auth';function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditAvatarPopupOpen=_useState2[0],setEditAvatarPopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isEditProfilePopupOpen=_useState4[0],setEditProfilePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isAddPlacePopupOpen=_useState6[0],setAddPlacePopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isInfoToolTipOpen=_useState8[0],setInfoToolTipOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),selectedCard=_useState10[0],setSelectedCard=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isDeleteCardPopupOpen=_useState12[0],setDeleteCardPopupOpen=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),cardDelete=_useState14[0],setCardDelete=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),currentUser=_useState16[0],setCurrentUser=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),cards=_useState18[0],setCards=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),isLoading=_useState20[0],setLoading=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isSuccess=_useState22[0],setSuccess=_useState22[1];var _useState23=useState(''),_useState24=_slicedToArray(_useState23,2),userEmail=_useState24[0],setUserEmail=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),loggedIn=_useState26[0],setLoggedIn=_useState26[1];var history=useHistory();useEffect(function(){Promise.all([api.getUserInfo(),api.getInitialCards()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),user=_ref2[0],cards=_ref2[1];setCurrentUser(user);setCards(cards);}).catch(function(err){console.log(err);});},[]);var tokenCheck=function tokenCheck(){var jwt=getToken('jwt');if(!jwt){return;}auth.checkToken(jwt).then(function(res){setLoggedIn(true);history.push('/');setUserEmail(res.data.email);}).catch(function(err){setLoggedIn(false);if(err.status===401){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0441 \\u043A\\u043E\\u0434\\u043E\\u043C \".concat(err.status,\" - \\u041F\\u0435\\u0440\\u0435\\u0434\\u0430\\u043D\\u043D\\u044B\\u0439 \\u0442\\u043E\\u043A\\u0435\\u043D \\u043D\\u0435\\u043A\\u043E\\u0440\\u0440\\u0435\\u043A\\u0442\\u0435\\u043D\"));}else{console.log(err);}});};useEffect(function(){tokenCheck();},[]);var handleLogin=function handleLogin(userEmail,userPassword){auth.authorize(userEmail,userPassword).then(function(data){setToken(data.token);setLoggedIn(true);setUserEmail(userEmail);history.push('/');}).catch(function(err){if(err.status===400){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0441 \\u043A\\u043E\\u0434\\u043E\\u043C \".concat(err.status,\" - \\u043D\\u0435 \\u043F\\u0435\\u0440\\u0435\\u0434\\u0430\\u043D\\u043E \\u043E\\u0434\\u043D\\u043E \\u0438\\u0437 \\u043F\\u043E\\u043B\\u0435\\u0439\"));}else if(err.status===401){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0441 \\u043A\\u043E\\u0434\\u043E\\u043C \".concat(err.status,\" - \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044C \\u0441 email \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\"));}else{console.log(err);}});};var handleLogOut=function handleLogOut(){setLoggedIn(false);removeToken('jwt');};var handleRegister=function handleRegister(userEmail,userPassword){auth.register(userEmail,userPassword).then(function(){history.push('/signin');setSuccess(true);setInfoToolTipOpen(true);}).catch(function(err){setSuccess(false);setInfoToolTipOpen(true);if(err.status===400){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0441 \\u043A\\u043E\\u0434\\u043E\\u043C \".concat(err.status,\" - \\u043D\\u0435 \\u043A\\u043E\\u0440\\u0440\\u0435\\u043A\\u0442\\u043D\\u043E \\u0437\\u0430\\u043F\\u043E\\u043B\\u043D\\u0435\\u043D\\u043E \\u043E\\u0434\\u043D\\u043E \\u0438\\u0437 \\u043F\\u043E\\u043B\\u0435\\u0439\"));}else{console.log(err);}});};var handleEditAvatarClick=function handleEditAvatarClick(){setEditAvatarPopupOpen(true);};var handleEditProfileClick=function handleEditProfileClick(){setEditProfilePopupOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setAddPlacePopupOpen(true);};var handleDeleteCardClick=function handleDeleteCardClick(card){setDeleteCardPopupOpen(true);setCardDelete(card);};var closeAllPopups=function closeAllPopups(){setEditAvatarPopupOpen(false);setEditProfilePopupOpen(false);setAddPlacePopupOpen(false);setSelectedCard(false);setDeleteCardPopupOpen(false);setInfoToolTipOpen(false);setLoading(false);};var handleUpdateUser=function handleUpdateUser(newUserInfo){setLoading(true);api.sendUserInfo(newUserInfo).then(function(user){setCurrentUser(user);closeAllPopups();}).catch(function(err){console.log(err);});};var handleUpdateAvatar=function handleUpdateAvatar(newAvatarLink){setLoading(true);api.sendUserAvatar(newAvatarLink).then(function(user){setCurrentUser(user);closeAllPopups();}).catch(function(err){console.log(err);});};var handleCardLike=function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});var handleLikeCards=function handleLikeCards(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard:c;});setCards(newCards);};var changeLike=function changeLike(){if(!isLiked){api.likeCard(card._id).then(function(newCard){handleLikeCards(newCard);}).catch(function(err){console.log(err);});}else{api.deleteLikeCard(card._id).then(function(newCard){handleLikeCards(newCard);}).catch(function(err){console.log(err);});}};changeLike();};var handleCardDelete=function handleCardDelete(card){setLoading(true);api.deleteCard(card._id).then(function(){var newCards=cards.filter(function(c){return c._id!==card._id;});setCards(newCards);closeAllPopups();}).catch(function(err){console.log(err);});};var handleAddPlaceSubmit=function handleAddPlaceSubmit(newCard){setLoading(true);api.sendCard(newCard).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);});};return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(BrowserRouter,{children:[/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,children:[/*#__PURE__*/_jsx(Header,{userEmail:userEmail,loggedIn:loggedIn,onSignOut:handleLogOut,linkTo:\"/signin\",linkName:\"\\u0412\\u044B\\u0439\\u0442\\u0438\"}),/*#__PURE__*/_jsx(Main,{onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:setSelectedCard,onCardLike:handleCardLike,onDeleteCardClick:handleDeleteCardClick,cards:cards}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,isLoading:isLoading}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,isLoading:isLoading}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,isLoading:isLoading}),/*#__PURE__*/_jsx(DeleteCardPopup,{card:cardDelete,isOpen:isDeleteCardPopupOpen,onClose:closeAllPopups,onCardDelete:handleCardDelete,isLoading:isLoading}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(Footer,{})]}),/*#__PURE__*/_jsxs(Route,{path:\"/signin\",children:[/*#__PURE__*/_jsx(Header,{userEmail:\"\",loggedIn:loggedIn,onSignOut:handleLogOut,linkTo:\"/signup\",linkName:\"\\u0420\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u044F\"}),/*#__PURE__*/_jsx(Login,{onLogin:handleLogin})]}),/*#__PURE__*/_jsxs(Route,{path:\"/signup\",children:[/*#__PURE__*/_jsx(Header,{userEmail:\"\",loggedIn:loggedIn,onSignOut:handleLogOut,linkTo:\"/signin\",linkName:\"\\u0412\\u043E\\u0439\\u0442\\u0438\"}),/*#__PURE__*/_jsx(Register,{onRegister:handleRegister}),/*#__PURE__*/_jsx(InfoToolTip,{isOpen:isInfoToolTipOpen,onClose:closeAllPopups,isSuccess:isSuccess})]})]})]})})})});}export default App;","map":{"version":3,"sources":["/Users/boris/dev/react-mesto-auth/src/components/App.js"],"names":["React","useEffect","useState","Route","Switch","BrowserRouter","useHistory","Redirect","Header","Register","Login","Main","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","DeleteCardPopup","InfoToolTip","Footer","api","ProtectedRoute","CurrentUserContext","setToken","getToken","removeToken","auth","App","isEditAvatarPopupOpen","setEditAvatarPopupOpen","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","isInfoToolTipOpen","setInfoToolTipOpen","selectedCard","setSelectedCard","isDeleteCardPopupOpen","setDeleteCardPopupOpen","cardDelete","setCardDelete","currentUser","setCurrentUser","cards","setCards","isLoading","setLoading","isSuccess","setSuccess","userEmail","setUserEmail","loggedIn","setLoggedIn","history","Promise","all","getUserInfo","getInitialCards","then","user","catch","err","console","log","tokenCheck","jwt","checkToken","res","push","data","email","status","handleLogin","userPassword","authorize","token","handleLogOut","handleRegister","register","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleDeleteCardClick","card","closeAllPopups","handleUpdateUser","newUserInfo","sendUserInfo","handleUpdateAvatar","newAvatarLink","sendUserAvatar","handleCardLike","isLiked","likes","some","i","_id","handleLikeCards","newCard","newCards","map","c","changeLike","likeCard","deleteLikeCard","handleCardDelete","deleteCard","filter","handleAddPlaceSubmit","sendCard"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Route, Switch, BrowserRouter, useHistory, Redirect} from 'react-router-dom';\nimport Header from './Header';\nimport Register from './Register';\nimport Login from './Login';\nimport Main from './Main';\nimport ImagePopup from './ImagePopup';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport DeleteCardPopup from './DeleteCardPopup';\nimport InfoToolTip from './InfoTooltip';\nimport Footer from './Footer';\nimport api from '../utils/api';\nimport ProtectedRoute from './ProtectedRoute';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport { setToken, getToken, removeToken } from '../utils/token';\nimport * as auth from '../utils/auth';\n\nfunction App() {\n  const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = useState(false);\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false);\n  const [isInfoToolTipOpen, setInfoToolTipOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(false);\n  const [isDeleteCardPopupOpen, setDeleteCardPopupOpen] = useState(false);\n  const [cardDelete, setCardDelete] = useState('')\n  const [currentUser, setCurrentUser] = useState('');\n  const [cards, setCards] = useState([]);\n  const [isLoading, setLoading] = useState(false);\n  const [isSuccess, setSuccess] = useState(false);\n\n  const [userEmail, setUserEmail] = useState('');\n  const [loggedIn, setLoggedIn] = useState(false);\n\n  const history = useHistory();\n\n  useEffect(() => {\n    Promise.all([api.getUserInfo(), api.getInitialCards()])\n      .then(([user, cards]) => {\n        setCurrentUser(user);\n        setCards(cards);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }, []);\n\n  const tokenCheck = () => {\n    const jwt = getToken('jwt');\n\n    if(!jwt) {\n      return;\n    }\n\n    auth.checkToken(jwt)\n    .then((res) => {\n      setLoggedIn(true);\n      history.push('/');\n      setUserEmail(res.data.email)\n    })\n    .catch((err) => {\n      setLoggedIn(false);\n      if(err.status === 401) {\n        console.log(`Ошибка с кодом ${err.status} - Переданный токен некорректен`);\n      } else {\n        console.log(err);\n      }\n    });\n  }\n\n  useEffect(() => {\n    tokenCheck();\n  }, []);\n\n  const handleLogin = (userEmail, userPassword) => {\n    auth.authorize(userEmail, userPassword)\n    .then((data) => {\n      setToken(data.token)\n      setLoggedIn(true);\n      setUserEmail(userEmail);\n      history.push('/');\n    })\n    .catch((err) => {\n      if(err.status === 400) {\n        console.log(`Ошибка с кодом ${err.status} - не передано одно из полей`);\n      } else if(err.status === 401) {\n        console.log(`Ошибка с кодом ${err.status} - пользователь с email не найден`);\n      } else {\n        console.log(err);\n      }\n    });\n  };\n\n  const handleLogOut = () => {\n    setLoggedIn(false);\n    removeToken('jwt');\n  };\n\n  const handleRegister = (userEmail, userPassword) => {\n    auth.register(userEmail, userPassword)\n      .then(() => {\n        history.push('/signin');\n        setSuccess(true);\n        setInfoToolTipOpen(true);\n      })\n      .catch((err) => {\n        setSuccess(false);\n        setInfoToolTipOpen(true);\n        if(err.status === 400) {\n          console.log(`Ошибка с кодом ${err.status} - не корректно заполнено одно из полей`);\n        } else {\n          console.log(err);\n        }\n      });\n  };\n\n  const handleEditAvatarClick = () => {\n    setEditAvatarPopupOpen(true);\n  };\n\n  const handleEditProfileClick = () => {\n    setEditProfilePopupOpen(true);\n  };\n\n  const handleAddPlaceClick = () => {\n    setAddPlacePopupOpen(true);\n  };\n\n  const handleDeleteCardClick = (card) => {\n    setDeleteCardPopupOpen(true);\n    setCardDelete(card)\n  };\n\n  const closeAllPopups = () => {\n    setEditAvatarPopupOpen(false);\n    setEditProfilePopupOpen(false);\n    setAddPlacePopupOpen(false);\n    setSelectedCard(false);\n    setDeleteCardPopupOpen(false);\n    setInfoToolTipOpen(false);\n    setLoading(false);\n  };\n\n  const handleUpdateUser = (newUserInfo) => {\n    setLoading(true);\n    api.sendUserInfo(newUserInfo)\n      .then((user) => {\n          setCurrentUser(user);\n          closeAllPopups();\n      })\n      .catch((err) => {\n          console.log(err);\n      });\n  };\n\n  const handleUpdateAvatar = (newAvatarLink) => {\n    setLoading(true);\n    api.sendUserAvatar(newAvatarLink)\n      .then((user) => {\n        setCurrentUser(user);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  const handleCardLike = (card) => {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n    const handleLikeCards = (newCard) => {\n      const newCards = cards.map((c) => c._id === card._id ? newCard : c);\n      setCards(newCards);\n    }\n\n    const changeLike = () => {\n      if(!isLiked) {\n        api.likeCard(card._id)\n          .then((newCard) => {\n            handleLikeCards(newCard);\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n      } else {\n        api.deleteLikeCard(card._id)\n          .then((newCard) => {\n            handleLikeCards(newCard);\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n      }\n    }\n\n    changeLike();\n  };\n\n  const handleCardDelete = (card) => {\n    setLoading(true);\n    api.deleteCard(card._id)\n      .then(() => {\n        const newCards = cards.filter((c) => c._id !== card._id);\n        setCards(newCards);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  const handleAddPlaceSubmit = (newCard) => {\n    setLoading(true);\n    api.sendCard(newCard)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  return(\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page\">\n        <>\n          <BrowserRouter>\n\n            <Route>\n              {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/signin\" />}\n            </Route>\n\n            <Switch>\n\n              <ProtectedRoute exact path=\"/\" loggedIn={loggedIn}>\n                <Header\n                  userEmail={userEmail}\n                  loggedIn={loggedIn}\n                  onSignOut={handleLogOut}\n                  linkTo=\"/signin\"\n                  linkName=\"Выйти\"\n                />\n                <Main\n                  onEditAvatar={handleEditAvatarClick}\n                  onEditProfile={handleEditProfileClick}\n                  onAddPlace={handleAddPlaceClick}\n                  onCardClick={setSelectedCard}\n                  onCardLike={handleCardLike}\n                  onDeleteCardClick={handleDeleteCardClick}\n                  cards={cards}\n                />\n                <EditAvatarPopup\n                  isOpen={isEditAvatarPopupOpen}\n                  onClose={closeAllPopups}\n                  onUpdateAvatar={handleUpdateAvatar}\n                  isLoading={isLoading}\n                />\n\n                <EditProfilePopup\n                  isOpen={isEditProfilePopupOpen}\n                  onClose={closeAllPopups}\n                  onUpdateUser={handleUpdateUser}\n                  isLoading={isLoading}\n                />\n\n                <AddPlacePopup\n                  isOpen={isAddPlacePopupOpen}\n                  onClose={closeAllPopups}\n                  onAddPlace={handleAddPlaceSubmit}\n                  isLoading={isLoading}\n                />\n                <DeleteCardPopup\n                  card={cardDelete}\n                  isOpen={isDeleteCardPopupOpen}\n                  onClose={closeAllPopups}\n                  onCardDelete={handleCardDelete}\n                  isLoading={isLoading}\n                />\n                <ImagePopup\n                  card={selectedCard}\n                  onClose={closeAllPopups}\n                />\n                <Footer />\n              </ProtectedRoute>\n\n              <Route path=\"/signin\">\n                <Header\n                  userEmail=''\n                  loggedIn={loggedIn}\n                  onSignOut={handleLogOut}\n                  linkTo=\"/signup\"\n                  linkName=\"Регистрация\"\n                />\n                <Login\n                  onLogin={handleLogin}\n                />\n              </Route>\n\n              <Route path=\"/signup\">\n                < Header\n                  userEmail=''\n                  loggedIn={loggedIn}\n                  onSignOut={handleLogOut}\n                  linkTo=\"/signin\"\n                  linkName=\"Войти\"\n                />\n                <Register\n                  onRegister={handleRegister}\n                />\n                <InfoToolTip\n                  isOpen={isInfoToolTipOpen}\n                  onClose={closeAllPopups}\n                  isSuccess={isSuccess}\n                />\n              </Route>\n\n            </Switch>\n\n          </BrowserRouter>\n\n        </>\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}